mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "Less Than High School Education",
subtitle = paste0("Estimate, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
##create Multiracial less than HS educational attainment plot for CoV
less_than_hs_multiracial_CoV <- list()
for(year in years){
year.idx <- match(year, years)
less_than_hs_other_CoV[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(less_than_hs == 1) %>%
group_by(GEOID, less_than_hs) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = CoV)) +
labs(title = "Less Than High School Education",
subtitle = paste0("Coefficient of Variation, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
pdf('less_than_hs_multiracial_over_time.pdf',
width = 8, height = 4)
for(year in years){
grid.arrange(less_than_hs_multiracial_estimate[[as.character(year)]],
less_than_hs_multiracial_CoV[[as.character(year)]], ncol = 2)
}
dev.off()
#####Part 5B - multiracial high school grad/equivalent
hs_multiracial_estimate <- list()
for(year in years){
year.idx <- match(year, years)
hs_multiracial_estimate[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(hs_grad == 1) %>%
group_by(GEOID, hs_grad) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "High School Graduate or Equivalent Education",
subtitle = paste0("Estimate, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
##create Multiracial less than HS educational attainment plot for CoV
hs_multiracial_CoV <- list()
for(year in years){
year.idx <- match(year, years)
hs_other_CoV[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(hs_grad == 1) %>%
group_by(GEOID, hs_grad) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = CoV)) +
labs(title = "High School Graduate or Equivalent Education",
subtitle = paste0("Coefficient of Variation, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
pdf('hs_multiracial_over_time.pdf',
width = 8, height = 4)
for(year in years){
grid.arrange(hs_multiracial_estimate[[as.character(year)]],
hs_multiracial_CoV[[as.character(year)]], ncol = 2)
}
dev.off()
C15002G_acs <- lapply(years, function(x){
get_acs("tract",
table = "C15002G",
year = x,
state = "WA",
county = "King",
geometry = TRUE,
survey = "acs5",
moe = 90,
cache_table = TRUE) %>%
mutate(Year = x)})
table_C15002G <- var_df %>%
filter(str_starts(name, "C15002G")) %>%
mutate(short_label = str_split(label, "!!"),
short_label = map_chr(short_label, tail, 1)) %>%
dplyr::select(name, short_label)
#create my own indicators
table_C15002G$less_than_hs <- ifelse(table_C15002G$short_label == "Less than high school diploma", 1, 0)
table_C15002G$hs_grad <- ifelse(table_C15002G$short_label == "High school graduate (includes equivalency)", 1, 0)
table_C15002G$some_college <- ifelse(table_C15002G$short_label == "Some college or associate's degree", 1, 0)
table_C15002G$college_grad <- ifelse(table_C15002G$short_label == "Bachelor's degree or higher", 1, 0)
less_than_hs_multiracial_estimate <- list()
for(year in years){
year.idx <- match(year, years)
less_than_hs_multiracial_estimate[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(less_than_hs == 1) %>%
group_by(GEOID, less_than_hs) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "Less Than High School Education",
subtitle = paste0("Estimate, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
##create Multiracial less than HS educational attainment plot for CoV
less_than_hs_multiracial_CoV <- list()
for(year in years){
year.idx <- match(year, years)
less_than_hs_other_CoV[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(less_than_hs == 1) %>%
group_by(GEOID, less_than_hs) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = CoV)) +
labs(title = "Less Than High School Education",
subtitle = paste0("Coefficient of Variation, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
pdf('less_than_hs_multiracial_over_time.pdf',
width = 8, height = 4)
for(year in years){
grid.arrange(less_than_hs_multiracial_estimate[[as.character(year)]],
less_than_hs_multiracial_CoV[[as.character(year)]], ncol = 2)
}
dev.off()
#####Part 5B - multiracial high school grad/equivalent
hs_multiracial_estimate <- list()
for(year in years){
year.idx <- match(year, years)
hs_multiracial_estimate[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(hs_grad == 1) %>%
group_by(GEOID, hs_grad) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "High School Graduate or Equivalent Education",
subtitle = paste0("Estimate, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
##create Multiracial less than HS educational attainment plot for CoV
hs_multiracial_CoV <- list()
for(year in years){
year.idx <- match(year, years)
hs_other_CoV[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(hs_grad == 1) %>%
group_by(GEOID, hs_grad) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = CoV)) +
labs(title = "High School Graduate or Equivalent Education",
subtitle = paste0("Coefficient of Variation, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
pdf('hs_multiracial_over_time.pdf',
width = 8, height = 4)
for(year in years){
grid.arrange(hs_multiracial_estimate[[as.character(year)]],
hs_multiracial_CoV[[as.character(year)]], ncol = 2)
}
dev.off()
### Part 7 - 2 or more races educational attainment
C15002G_acs <- lapply(years, function(x){
get_acs("tract",
table = "C15002G",
year = x,
state = "WA",
county = "King",
geometry = TRUE,
survey = "acs5",
moe = 90,
cache_table = TRUE) %>%
mutate(Year = x)})
uni_other_estimate <- list()
for(year in years){
year.idx <- match(year, years)
uni_other_estimate[[as.character(year)]] <- C15002F_acs[[year.idx]] %>%
left_join(table_C15002F, by = c("variable" = "name"))%>%
filter(college_grad == 1) %>%
group_by(GEOID, college_grad) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "Bachelor's Degree or Higher",
subtitle = paste0("Estimate, Other Race, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
##create Asian less than HS educational attainment plot for CoV
uni_other_CoV <- list()
for(year in years){
year.idx <- match(year, years)
uni_other_CoV[[as.character(year)]] <- C15002F_acs[[year.idx]] %>%
left_join(table_C15002F, by = c("variable" = "name"))%>%
filter(college_grad == 1) %>%
group_by(GEOID, college_grad) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = CoV)) +
labs(title = "Bachelor's Degree or Higher",
subtitle = paste0("Coefficient of Variation, Other Race, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
pdf('college_grad_other_over_time.pdf',
width = 8, height = 4)
for(year in years){
grid.arrange(uni_other_estimate[[as.character(year)]],
uni_other_CoV[[as.character(year)]], ncol = 2)
}
dev.off()
C15002G_acs <- lapply(years, function(x){
get_acs("tract",
table = "C15002G",
year = x,
state = "WA",
county = "King",
geometry = TRUE,
survey = "acs5",
moe = 90,
cache_table = TRUE) %>%
mutate(Year = x)})
table_C15002G <- var_df %>%
filter(str_starts(name, "C15002G")) %>%
mutate(short_label = str_split(label, "!!"),
short_label = map_chr(short_label, tail, 1)) %>%
dplyr::select(name, short_label)
#create my own indicators
table_C15002G$less_than_hs <- ifelse(table_C15002G$short_label == "Less than high school diploma", 1, 0)
table_C15002G$hs_grad <- ifelse(table_C15002G$short_label == "High school graduate (includes equivalency)", 1, 0)
table_C15002G$some_college <- ifelse(table_C15002G$short_label == "Some college or associate's degree", 1, 0)
table_C15002G$college_grad <- ifelse(table_C15002G$short_label == "Bachelor's degree or higher", 1, 0)
less_than_hs_multiracial_estimate <- list()
for(year in years){
year.idx <- match(year, years)
less_than_hs_multiracial_estimate[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(less_than_hs == 1) %>%
group_by(GEOID, less_than_hs) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "Less than High School Education",
subtitle = paste0("Estimate, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
##create Asian less than HS educational attainment plot for CoV
less_than_hs_multiracial_CoV <- list()
for(year in years){
year.idx <- match(year, years)
less_than_hs_multiracial_CoV[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(less_than_hs == 1) %>%
group_by(GEOID, less_than_hs) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = CoV)) +
labs(title = "Less Than High School Education",
subtitle = paste0("Coefficient of Variation, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
pdf('less_than_hs_multiracial_over_time.pdf',
width = 8, height = 4)
for(year in years){
grid.arrange(less_than_hs_multiracial_estimate[[as.character(year)]],
less_than_hs_multiracial_CoV[[as.character(year)]], ncol = 2)
}
dev.off()
hs_multiracial_estimate <- list()
for(year in years){
year.idx <- match(year, years)
hs_multiracial_estimate[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(hs_grad == 1) %>%
group_by(GEOID, hs_grad) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "High School Graduate or Equivalent Education",
subtitle = paste0("Estimate, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
##create HS grad educational attainment plot for CoV
hs_multiracial_CoV <- list()
for(year in years){
year.idx <- match(year, years)
hs_multiracial_CoV[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(hs_grad == 1) %>%
group_by(GEOID, hs_grad) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = CoV)) +
labs(title = "High School Graduate or Equivalent",
subtitle = paste0("Coefficient of Variation, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
pdf('hs_multiracial_over_time.pdf',
width = 8, height = 4)
for(year in years){
grid.arrange(hs_multiracial_estimate[[as.character(year)]],
hs_multiracial_CoV[[as.character(year)]], ncol = 2)
}
dev.off()
SC_AA_multiracial_estimate <- list()
for(year in years){
year.idx <- match(year, years)
SC_AA_multiracial_estimate[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(some_college == 1) %>%
group_by(GEOID, some_college) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "Some College or Associate's Degree",
subtitle = paste0("Estimate, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
##create some college grad educational attainment plot for CoV
SC_AA_multiracial_CoV <- list()
for(year in years){
year.idx <- match(year, years)
SC_AA_multiracial_CoV[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(some_college == 1) %>%
group_by(GEOID, some_college) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = CoV)) +
labs(title = "Some College or Associate's Degree",
subtitle = paste0("Coefficient of Variation, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
pdf('some_college_multiracial_over_time.pdf',
width = 8, height = 4)
for(year in years){
grid.arrange(SC_AA_multiracial_estimate[[as.character(year)]],
SC_AA_multiracial_CoV[[as.character(year)]], ncol = 2)
}
dev.off()
uni_multiracial_estimate <- list()
for(year in years){
year.idx <- match(year, years)
uni_multiracial_estimate[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(college_grad == 1) %>%
group_by(GEOID, college_grad) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "Bachelor's Degree or Higher",
subtitle = paste0("Estimate, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
##create college grad educational attainment plot for CoV
uni_multiracial_CoV <- list()
for(year in years){
year.idx <- match(year, years)
uni_multiracial_CoV[[as.character(year)]] <- C15002G_acs[[year.idx]] %>%
left_join(table_C15002G, by = c("variable" = "name"))%>%
filter(college_grad == 1) %>%
group_by(GEOID, college_grad) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = CoV)) +
labs(title = "Bachelor's Degree or Higher",
subtitle = paste0("Coefficient of Variation, Two or More Races, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
pdf('college_grad_multiracial_over_time.pdf',
width = 8, height = 4)
for(year in years){
grid.arrange(uni_multiracial_estimate[[as.character(year)]],
uni_multiracial_CoV[[as.character(year)]], ncol = 2)
}
dev.off()
