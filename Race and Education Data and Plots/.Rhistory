multiracial_hs_estimate_plot <- multiracial_hs %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "High School Graduate or Equivalent Education, 2 or More Races",
subtitle = "Using Estimate Value")+
facet_wrap(vars(hs_grad)) +
scale_fill_viridis_c() +
theme_void()
multiracial_hs_CoV_plot <- multiracial_hs %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = CoV)) +
labs(title = "High School Graduate or Equivalent Education, 2 or More Races",
subtitle = "Coefficient of Variance",
fill = "Coefficient of Variance") +
facet_wrap(vars(hs_grad)) +
scale_fill_viridis_c() +
theme_void()
multiracial_SC_AA <- tract_edu_multiracial_lab %>%
filter(some_college == 1) %>%
group_by(GEOID, some_college) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()
multiracial_SC_AA<- multiracial_SC_AA %>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate)
multiracial_SC_AA_estimate_plot <- multiracial_SC_AA %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "Some College or Associate's Degree, 2 or More Races",
subtitle = "Using Estimate Value")+
facet_wrap(vars(some_college)) +
scale_fill_viridis_c() +
theme_void()
multiracial_SC_AA_CoV_plot <- multiracial_SC_AA %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = CoV)) +
labs(title = "Some College or Associate's Degree, 2 or More Races",
subtitle = "Coefficient of Variance",
fill = "Coefficient of Variance") +
facet_wrap(vars(some_college)) +
scale_fill_viridis_c() +
theme_void()
multiracial_college_grad <- tract_edu_multiracial_lab %>%
filter(college_grad == 1) %>%
group_by(GEOID, college_grad) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()
multiracial_college_grad<- multiracial_college_grad %>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate)
multiracial_college_grad_estimate_plot <- multiracial_college_grad %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "Bachelor's Degree or Higher, 2 or More Races",
subtitle = "Using Estimate Value")+
facet_wrap(vars(college_grad)) +
scale_fill_viridis_c() +
theme_void()
multiracial_college_grad_estimate_plot
multiracial_college_grad_CoV_plot <- multiracial_college_grad %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = CoV)) +
labs(title = "Bachelor's Degree or Higher, 2 or More Races",
subtitle = "Coefficient of Variance",
fill = "Coefficient of Variance") +
facet_wrap(vars(college_grad)) +
scale_fill_viridis_c() +
theme_void()
load("~/Desktop/PHI2021/Data/tracts_to_hra.rda")
hra <- st_read("~/Desktop/PHI2021/Data/HRA_2010Block_Clip.shp")
pop_by_hra <- list()
for(year in years){
pop_by_hra[[paste0("acs5_", year)]] <-
## take tracts_to_hra file and left_join()
## my variable from the census
tracts_to_hra[[paste0("acs5_", year)]] %>%
left_join(kc_tracts_white[[paste0("acs5_", year)]] %>%
dplyr::select(GEOID, estimate, moe)) %>%
## group_by() HRA and get a weighted sum
## of tract contributions to HRA
group_by(FID_HRA_20) %>%
summarise(less_than_hs_estimate = sum(prop.area*estimate* less_than_hs),
moe = sum(prop.area*moe* less_than_hs)) %>%
mutate(SE = moe/qnorm(.95),
CoV = SE/estimate)
## Make sure data frames follow ordering of shapefile
reorder.idx <- match(pop_by_hra[[paste0("acs5_", year)]]$FID_HRA_20,
hra$FID_HRA_20)
pop_by_hra[[paste0("acs5_", year)]] <-
pop_by_hra[[paste0("acs5_", year)]][reorder.idx,]
kc_tracts_white[[paste0("acs5_", year)]] <-
kc_tracts_white[[paste0("acs5_", year)]]%>%
mutate(SE = moe/qnorm(.95),
CoV = SE/estimate)
}
lapply(kc_tracts_white, function(x){
range(x$estimate)
})
lapply(pop_by_hra, function(x){
range(x$estimate)
})
less_than_hs_white_hra_estimate <- list()
for(year in years){
year.idx <- match(year, years)
less_than_hs_white_hra_estimate[[as.character(year)]] <- raw_inc_df[[year.idx]] %>%
left_join(table_C15002A, by = c("variable" = "name"))%>%
filter(less_than_hs == 1) %>%
group_by(GEOID, less_than_hs) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
years <- seq(2019, 2009, -5)
##white alone census tract to HRA data
kc_tracts_white <- list()
for(yr in years){
kc_tracts_white[[paste0("acs5_",yr)]] <- get_acs("tract",
table = "C15002A",
geometry = TRUE,
year = yr,
survey = "acs5",
state = "WA",
county = "King",
cache_table = TRUE) %>%
left_join(table_C15002A, by = c('variable' = 'name'))
}
names(kc_tracts_white)
lapply(kc_tracts_white, class)
lapply(kc_tracts_white, st_crs)
load("~/Desktop/PHI2021/Data/tracts_to_hra.rda")
hra <- st_read("~/Desktop/PHI2021/Data/HRA_2010Block_Clip.shp")
library(RColorBrewer)
library(classInt)
library(scales)
library(tidyr)
library(tidycensus)
library(tidyverse)
library(sf)
library(stringr)
library(ipumsr)
library(data.table)
library(gridExtra)
library(sp)
library(rgdal)
library(rgeos)
library(geosphere)
years <- seq(2019, 2009, -5)
##white alone census tract to HRA data
kc_tracts_white <- list()
for(yr in years){
kc_tracts_white[[paste0("acs5_",yr)]] <- get_acs("tract",
table = "C15002A",
geometry = TRUE,
year = yr,
survey = "acs5",
state = "WA",
county = "King",
cache_table = TRUE) %>%
left_join(table_C15002A, by = c('variable' = 'name'))
}
names(kc_tracts_white)
lapply(kc_tracts_white, class)
lapply(kc_tracts_white, st_crs)
load("~/Desktop/PHI2021/Data/tracts_to_hra.rda")
hra <- st_read("~/Desktop/PHI2021/Data/HRA_2010Block_Clip.shp")
pop_by_hra <- list()
for(year in years){
pop_by_hra[[paste0("acs5_", year)]] <-
## take tracts_to_hra file and left_join()
## my variable from the census
tracts_to_hra[[paste0("acs5_", year)]] %>%
left_join(kc_tracts_white[[paste0("acs5_", year)]] %>%
dplyr::select(GEOID, estimate, moe)) %>%
## group_by() HRA and get a weighted sum
## of tract contributions to HRA
group_by(FID_HRA_20) %>%
summarise(less_than_hs_estimate = sum(prop.area*estimate* less_than_hs),
moe = sum(prop.area*moe* less_than_hs)) %>%
mutate(SE = moe/qnorm(.95),
CoV = SE/estimate)
## Make sure data frames follow ordering of shapefile
reorder.idx <- match(pop_by_hra[[paste0("acs5_", year)]]$FID_HRA_20,
hra$FID_HRA_20)
pop_by_hra[[paste0("acs5_", year)]] <-
pop_by_hra[[paste0("acs5_", year)]][reorder.idx,]
kc_tracts_white[[paste0("acs5_", year)]] <-
kc_tracts_white[[paste0("acs5_", year)]]%>%
mutate(SE = moe/qnorm(.95),
CoV = SE/estimate)
}
lapply(kc_tracts_white, function(x){
range(x$estimate)
})
lapply(pop_by_hra, function(x){
range(x$estimate)
})
less_than_hs_white_hra_estimate <- list()
for(year in years){
year.idx <- match(year, years)
less_than_hs_white_hra_estimate[[as.character(year)]] <- raw_inc_df[[year.idx]] %>%
left_join(table_C15002A, by = c("variable" = "name"))%>%
filter(less_than_hs == 1) %>%
group_by(GEOID, less_than_hs) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = estimate)) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
pop_by_hra <- list()
for(year in years){
pop_by_hra[[paste0("acs5_", year)]] <-
## take tracts_to_hra file and left_join()
## my variable from the census
tracts_to_hra[[paste0("acs5_", year)]] %>%
left_join(kc_tracts_white[[paste0("acs5_", year)]]) %>%
## group_by() HRA and get a weighted sum
## of tract contributions to HRA
group_by(FID_HRA_20) %>%
summarise(less_than_hs_estimate = sum(prop.area*estimate* less_than_hs),
moe_less_than_hs = sum(prop.area*less_than_hs * moe),
hs_estimate = sum(prop.area*estimate* hs_grad),
moe_hs = sum(prop.area* hs_grad * moe),
SC_AA_estimate = sum(prop.area *estimate * some_college),
moe_SC_AA = sum(prop.area * some_college* moe),
uni_estimate = sum(prop.area * estimate * college_grad),
moe_uni = sum(prop.area * college_grad * moe)) %>%
mutate(SE_less_than_hs = moe_less_than_hs/qnorm(.95),
CoV_less_than_hs = SE_less_than_hs/less_than_hs_estimate)
## Make sure data frames follow ordering of shapefile
reorder.idx <- match(pop_by_hra[[paste0("acs5_", year)]]$FID_HRA_20,
hra$FID_HRA_20)
pop_by_hra[[paste0("acs5_", year)]] <-
pop_by_hra[[paste0("acs5_", year)]][reorder.idx,]
}
lapply(kc_tracts_white, function(x){
range(x$estimate)
})
lapply(pop_by_hra, function(x){
range(x$estimate)
})
less_than_hs_white_estimate_plot <-
pop_by_hra %>%
select(FID_HRA_20, less_than_hs_estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = less_than_hs_estimate)) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
less_than_hs_white_estimate_plot <- list()
for(year in years){
pop_by_hra %>%
select(FID_HRA_20, less_than_hs_estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = less_than_hs_estimate)) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
less_than_hs_white_estimate_plot <- list()
for(year in years){
pop_by_hra %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = less_than_hs_estimate)) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
less_than_hs_white_estimate_plot <-
for(year in years){
pop_by_hra %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = less_than_hs_estimate)) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
less_than_hs_white_estimate_plot <-
for(year in years){
pop_by_hra %>%
ggplot() +
geom_sf(aes(fill = less_than_hs_estimate)) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
?geom_sf
s <- ggplot() +
geom_sf(edu_data, aes(fill = estimate)) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
library(tidycensus)
library(tidyverse)
library(sf)
library(stringr)
library(ipumsr)
library(data.table)
library(gridExtra)
library(sp)
library(rgdal)
library(rgeos)
library(geosphere)
library(RColorBrewer)
library(classInt)
library(scales)
library(tidyr)
library(jsonlite)
library(rjson)
library(geojsonsf)
s <- ggplot() +
geom_sf(edu_data, aes(fill = estimate)) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
edu_data <- read.csv("edu_attainment_data.csv")
setwd("~/Desktop/PHI2021")
edu_data <- read.csv("edu_attainment_data.csv")
setwd("~/Desktop/PHI2021/Race and Education Data and Plots")
edu_data <- read.csv("edu_attainment_data.csv")
s <- ggplot() +
geom_sf(edu_data, aes(fill = estimate)) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
s <- ggplot() +
geom_sf(edu_data, mapping = aes(fill = estimate)) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
print(s)
?stat_sf
s <- ggplot() +
geom_sf(edu_data, mapping = aes(fill = estimate),
stat = "edu_data_test$geometry") +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
### make graphs without the crazy stuff ^^
get_geometry <-
get_acs("tract",
table = "C15002B",
year = 2019,
state = "WA",
county = "King",
geometry = TRUE,
survey = "acs5",
moe = 90,
cache_table = TRUE)
edu_data_test <- get_geometry %>%
select(geometry)
s <- ggplot() +
geom_sf(edu_data, mapping = aes(fill = estimate),
stat = "edu_data_test$geometry") +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
s <- ggplot() +
geom_sf(edu_data, mapping = aes(fill = estimate),
stat = edu_data_test$geometry) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
s <- ggplot() +
geom_sf(edu_data, mapping = aes(fill = estimate), data = edu_data_test$geometry) +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
names(edu_data_test$geometry)
names(edu_data_test)
class(edu_data_test)
class(edu_data_test$geometry)
?sfc
st_as_sf(edu_data_test$geometry)
?geom_sf
s <- ggplot() +
geom_sf(edu_data, mapping = aes(fill = estimate), data = edu_data_test$geometry,
stat = "sf") +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
s <- ggplot() +
geom_sf(edu_data, mapping = aes(fill = estimate), data = edu_data_test$geometry,
stat = "sf", position = "identity") +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
print(s)
less_than_hs_white_estimate <- list()
for(year in years){
year.idx <- match(year, years)
less_than_hs_white_estimate[[as.character(year)]] <- edu_data %>%
filter(less_than_hs == 1) %>%
group_by(GEOID, less_than_hs) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
st_as_sf() %>%
ggplot() +
geom_sf(edu_data, mapping = aes(fill = estimate), data = edu_data_test$geometry,
stat = "sf", position = "identity") +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
years <- c(2009, 2014, 2019)
less_than_hs_white_estimate <- list()
for(year in years){
year.idx <- match(year, years)
less_than_hs_white_estimate[[as.character(year)]] <- edu_data %>%
filter(less_than_hs == 1) %>%
group_by(GEOID, less_than_hs) %>%
summarize(
estimate = sum(estimate),
moe = sum(moe)
) %>%
data.table()%>%
mutate(SE = moe/qnorm(.95)) %>%
mutate(CoV = SE/estimate) %>%
#st_as_sf() %>%
ggplot() +
geom_sf(edu_data, mapping = aes(fill = estimate), data = edu_data_test$geometry,
stat = "sf", position = "identity") +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
}
print(less_than_hs_white_estimate)
s <- ggplot() +
geom_sf(edu_data, mapping = aes(fill = estimate),
data = st_as_sf(edu_data_test$geometry),
stat = "sf", position = "identity") +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
View(s)
print(s)
names(s)
s$coordinates
class(s$coordinates)
s$coordinates[[1]]
s$coordinates[1]
## trying to get this plot to work
test <- ggplot() +
geom_sf(edu_data, mapping = aes(fill = estimate),
data = st_as_sf(edu_data_test$geometry),
stat = "sf", position = "identity") +
labs(title = "Less than High School",
subtitle = paste0("Estimate, White alone, ", year)) +
scale_fill_viridis_c() +
theme_void()
bind_rows(edu_data, edu_data_test)
rlang::last_error()
bind_cols(edu_data, edu_data_test)
